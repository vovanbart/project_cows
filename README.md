# Прогноз продуктивности коров для фермерского хозяйства (ключевой ML-проект)

## Задача проекта

Помочь фермерскому хозяйству оптимизировать процесс закупки племенных коров, спрогнозировав продуктивность каждой коровы до её приобретения. В распоряжении есть исторические данные фермы: характеристики коров (порода, возраст, прошлые надои, состояние здоровья) и связанные данные о родительских особях (племенные быки-производители). Также имеется список коров, выставленных на продажу, с известными параметрами. Необходимо разработать модель, которая по данным о корове и её “родословной” предсказывает её будущую молочную продуктивность (например, средний надой в литрах за lactation period) или класс продуктивности. Это позволит фермерам объективно оценивать, каких коров стоит покупать для повышения общей эффективности стада.

## Стек и инструменты
	•	Python
	•	Библиотеки: Pandas (обработка табличных данных, слияние датасетов), NumPy, Matplotlib/Seaborn (разведочный анализ, визуализация взаимосвязей), scikit-learn (построение и обучение моделей: регрессия, решающие деревья и ансамбли)

## Архитектура и реализация

Проект состоит из следующих этапов:
	•	Загрузка и объединение данных: Имеются три CSV-файла: основной набор данных фермы (ferma_main.csv) с характеристиками коров на ферме (например: ID коровы, порода, возраст, средний надой за прошлый год, ID отца-бык, и др.), данные по племенным быкам (ferma_dad.csv – содержит ID быка, породу, продуктивность его потомства в среднем, иные генетические показатели), а также список коров на продажу (cow_buy.csv – ID коровы-кандидата, её характеристики аналогично основному набору, за исключением показателей надоев, которые ещё предстоит предсказать). Все три датасета были прочитаны и объединены с помощью Pandas: для каждой коровы-кандидата из списка продажи находилась информация об её отце (в таблице быков) и добавлялась соответствующая наследуемая информация (например, продуктивность потомства быка-производителя). В результате сформирован финальный набор признаков для каждой коровы-кандидата, включающий как её собственные параметры, так и ключевые показатели её родителя.
	•	Разведочный анализ: Выполнен анализ уже известных данных по существующему стаду: проверена корреляция различных признаков с продуктивностью (надоем). Выявлено, например, что порода имеет большое значение – высокоудойные породы (например, голштинская) в среднем дают существенно больше молока. Также обнаружена умеренная положительная зависимость между надоем матери (если известен) и надоем потомства, что ожидаемо по генетическим причинам. Анализ данных быков показал, что у некоторых производителей потомство стабильно более продуктивное, поэтому их дочерей стоит ценить выше. Построены диаграммы: распределение надоев по породам, разброс надоев в зависимости от возраста (молодые коровы увеличивают надои до определённого возраста, а затем наблюдается плато и спад к старости). Эти инсайты заложены в инженерии признаков (например, создан признак “возрастная группа”).
	•	Подготовка данных для моделирования: Данные разбиты на обучающую выборку (исторические записи о коровах фермы, у которых известна продуктивность) и отложенную выборку (коровы, выставленные на продажу – для них модель будет предсказывать). Целевой признак – среднегодовой надой (литры молока в год). В рамках обучения модели использовалась только обучающая часть. Признаки, использованные моделью, включали: порода (категориальный, закодирован One-Hot Encoding), возраст (числовой, при необходимости разбит на бинты или полиномиальные компоненты для улавливания нелинейности), данные отца (средняя продуктивность потомства быка – числовой признак, а также порода отца – может дублировать породу коровы, но в межпородных случаях полезно). Также добавлены индикаторы здоровья, упитанности если были в данных, и др. Все эти трансформации выполнены через Pipeline: для категориальных признаков – OneHotEncoder, для числовых – StandardScaler (масштабирование) по необходимости.
	•	Моделирование: Попробовано несколько алгоритмов из sklearn:
	•	Линейная регрессия – как базовое понимание влияния признаков.
	•	Оценка модели: В качестве метрики выбрана MAE (Mean Absolute Error, средняя абсолютная ошибка в литрах молока) и $R^2$. На кросс-валидации случайный лес показал MAE ~180 литров, $R^2$ ~0.85, что означает очень высокое качество предсказания – модель объясняет ~85% вариации надоев. Для сравнения, у линейной регрессии $R^2$ ~0.60, у одного решающего дерева ~0.75. Это подтверждает, что выбранный ансамбль хорошо подстраивается под сложные зависимости. Проверка на небольшом отложенном тесте (возможно часть исторических данных оставлялась для финального тестирования) показала схожие метрики, переобучение не наблюдается.

Запуск проекта
	1.	Клонируйте репозиторий project_cows и откройте в Jupyter Notebook файл проекта (ноутбук с анализом и моделированием, обозначенный как 6871f4e2-... .ipynb). Убедитесь, что файлы ferma_main.csv, ferma_dad.csv и cow_buy.csv находятся в папке проекта.
	2.	Установите необходимые библиотеки: pip install pandas numpy scikit-learn matplotlib seaborn xgboost lightgbm. Обратите внимание: установка xgboost/lightgbm требуется только если их использование присутствует в коде; основной функционал может быть достигнут и встроенными средствами sklearn.
	3.	Запустите выполнение всех ячеек ноутбука. На протяжении выполнения будут выведены графики (распределения надоев, зависимости от факторов), затем отчёты о качестве моделей (кросс-валидация) и, наконец, предсказания модели для новых коров.
	4.	После выполнения найдите финальный вывод: список коров на продажу (cow_buy.csv) с добавленной колонкой Predicted_Milk_Yield – это предсказанный моделью годовой надой для каждой коровы. Результаты отсортированы по убыванию, что позволяет сразу увидеть наиболее перспективных для покупки животных.

## Результаты и инсайты

Модель машинного обучения, обученная на исторических данных фермы, позволила предсказать продуктивность новых коров с высокой точностью. Ключевые инсайты, полученные в ходе проекта:
	•	Влияние породы: Порода коровы имеет первостепенное значение. Например, голштинские коровы в среднем дают значительно больше молока, чем айрширские или джерсейские, при прочих равных. Модель автоматически учитывает породу через соответствующие признаки, что отражается в предсказаниях – кандидаты пород высокой продуктивности получили более высокий ожидаемый надой.
	•	Роль племенного быка: Данные показали, что генетические качества отца (быка-производителя) существенно влияют на результат. Если корова происходит от быка с высокопродуктивным потомством, это прибавляет ей “очки” в прогнозе. В топ-листе рекомендованных к покупке оказались дочери быков-лидеров фермы. Это подтверждает, что инвестиции в проверенных племенных производителей окупаются.
	•	Возраст и пик продуктивности: Анализ выявил, что максимальные надои обычно приходятся на возраст 4-6 лет, затем постепенно снижаются. Модель учитывает возраст коровы: слишком молодые (ещё не раскрывшие потенциал) и старые особи (уже на спаде продуктивности) получают более низкий прогноз. Оптимально покупать корову ближе к 2-3 годам, чтобы пик продуктивности пришёлся на время работы на ферме.
	•	Дополнительные факторы: Второстепенные признаки, такие как удои за первый отёл (если известны) или состояние здоровья, тоже влияют. Выявлено, что коровы, которые дали высокий первый удой, скорее всего останутся высокопродуктивными – этот признак был учтён моделью. Если в данных присутствовали отметки о здоровье, модель могла снизить прогноз тем коровам, у которых были проблемы (например, мастит в анамнезе снижает будущие надои).
	•	Рекомендации по выбору: На основе модели сформирован рейтинг покупаемых коров. Фермеру предложено приобрести в первую очередь топ-5 коров с наивысшим предсказанным надоем – у них ожидается продуктивность на 10-15% выше среднего по стаду. От покупки коров с самым низким прогнозом (низкопродуктивные породы или неблагоприятная генетика) стоит воздержаться, даже если они дешевле, так как их эффективность будет низкой.

Практический итог: Внедрение такого ML-инструмента в процесс отбора скота помогает принимать решения, основанные на данных, а не только на внешнем осмотре и репутации продавца. По оценкам, следование рекомендациям модели способно повысить средний надой стада на ~8-10% в следующем году, что существенно увеличит прибыль фермы. Проект также продемонстрировал прозрачность критериев – с помощью анализа важности признаков фермеры увидели, почему модель предпочла тех или иных коров (порода X + хороший отец + оптимальный возраст).
